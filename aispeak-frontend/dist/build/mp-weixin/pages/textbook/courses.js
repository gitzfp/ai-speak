"use strict";const e=require("../../common/vendor.js"),o=require("../../api/textbook.js"),s=require("../../api/topic.js");if(require("../../axios/api.js"),require("../../config/env.js"),!Array){e.resolveComponent("uni-load-more")()}Math;const t=e.defineComponent({__name:"courses",setup(t){const a=e.ref([]),r=e.ref(!1),n=e.ref(""),i=e.ref(null),d=async e=>{r.value=!0,n.value="";try{const{textbookId:s,categoryId:t}=e;if(!s||!t)throw new Error("Missing textbookId or categoryId");const r=await o.textbookRequest.getCourseDetail(s,t);if(console.log("Course detail response:",r.data.courses),!r.data)throw new Error("No data returned from server");a.value=r.data.courses}catch(s){n.value=s.message||"加载失败，请重试",console.error("Load courses error:",s)}finally{r.value=!1}},c=()=>{i.value&&d(i.value)};return e.onLoad((e=>{console.log("onLoad called with options:",e),i.value=e,d(e)})),(o,t)=>e.e({a:r.value},r.value?{b:e.p({status:"loading"})}:n.value?{d:e.t(n.value),e:e.o(c)}:{f:e.f(a.value,((o,t,a)=>{var r;return e.e({a:o.pic,b:e.t(o.title),c:e.t(o.sub_title),d:e.t(o.info_cn),e:e.t(o.info_en),f:e.t(null==(r=o.steps)?void 0:r.length),g:o.max_score},o.max_score?{h:e.t(o.max_score)}:{},{i:o.id,j:e.o((t=>(async o=>{try{const t=o.id,a=await s.topicRequest.getSessionByLessonId({lesson_id:t});if(null==a?void 0:a.data){const{id:o,completed:s,name:r}=a.data;if(o)return void e.index.navigateTo({url:`/pages/chat/index?sessionId=${o}&type=LESSON&lessonId=${t}&sessionName=${r}`})}s.topicRequest.createLessonSession({lesson_id:t}).then((o=>{e.index.navigateTo({url:`/pages/chat/index?sessionId=${o.data.id}&type=LESSON&lessonId=${t}&sessionName=${o.data.name}`})}))}catch(t){console.error("Error in handleCourseSelect:",t),e.index.showToast({title:"获取课程会话失败",icon:"none"})}})(o)),o.id)})}))},{c:n.value})}}),a=e._export_sfc(t,[["__scopeId","data-v-1c1c3f8d"]]);wx.createPage(a);
